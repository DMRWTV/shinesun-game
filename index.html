<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ShineSun Gold - Global Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --sun-gradient: linear-gradient(180deg, #FFD700 0%, #FF8C00 100%); --bg-color: #0b0b0b; --card-bg: #1c1c1e; --text-gold: #FFD700; }
        body { background-color: var(--bg-color); color: white; font-family: 'Inter', sans-serif; margin: 0; padding: 0; user-select: none; overflow: hidden; }
        .app-container { display: flex; flex-direction: column; height: 100vh; padding: 20px; box-sizing: border-box; }
        
        /* S√©lecteur de langue */
        .lang-select { position: fixed; top: 10px; right: 10px; background: #222; color: white; border: 1px solid var(--text-gold); border-radius: 5px; z-index: 2000; font-size: 12px; }

        .header-info { text-align: center; margin-top: 15px; }
        .combo-container { display: flex; justify-content: center; gap: 8px; margin: 10px 0; }
        .combo-slot { width: 40px; height: 40px; background: #222; border: 2px dashed #444; border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .combo-slot.active { border-color: var(--text-gold); background: var(--card-bg); border-style: solid; }
        .main-score { font-size: 40px; font-weight: 900; text-align: center; margin: 10px 0; color: var(--text-gold); }
        .game-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; }
        .sun-main { width: 190px; height: 190px; background: var(--sun-gradient); border-radius: 50%; box-shadow: 0 0 50px rgba(255, 140, 0, 0.4); cursor: pointer; transition: transform 0.05s; border: 8px solid rgba(255,255,255,0.1); }
        .sun-main:active { transform: scale(0.92); }
        
        .footer-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #151515; border-top: 1px solid #333; display: flex; justify-content: space-around; padding: 12px 0; z-index: 1000; }
        .nav-btn { color: #666; font-size: 10px; text-align: center; cursor: pointer; flex: 1; }
        .nav-btn.active { color: var(--text-gold); font-weight: bold; }
        
        .view-panel { position: fixed; top: 0; left: 0; width: 100%; height: 88vh; background: var(--bg-color); z-index: 500; display: none; padding: 20px; box-sizing: border-box; overflow-y: auto; padding-bottom: 100px; }
        .card-item { background: var(--card-bg); padding: 15px; border-radius: 16px; margin-bottom: 12px; border: 1px solid #2c2c2e; display: flex; justify-content: space-between; align-items: center; }
        .btn-buy { background: var(--text-gold); border: none; padding: 8px 15px; border-radius: 8px; font-weight: bold; color: black; cursor: pointer; }
        .btn-action { background: var(--text-gold); border: none; padding: 15px; border-radius: 12px; font-weight: bold; width: 100%; margin-top: 10px; cursor: pointer; }
    </style>
</head>
<body>

<select class="lang-select" id="lang-picker" onchange="changeLanguage(this.value)">
    <option value="fr">üá´üá∑ FR</option>
    <option value="en">üá∫üá∏ EN</option>
</select>

<div class="app-container" id="game-view">
    <div class="header-info">
        <div id="t-combo-title" style="font-size: 10px; color: #888;">COMBO QUOTIDIEN (+5,000,000)</div>
        <div class="combo-container">
            <div class="combo-slot" id="slot-0">?</div>
            <div class="combo-slot" id="slot-1">?</div>
            <div class="combo-slot" id="slot-2">?</div>
        </div>
    </div>
    <div class="main-score" id="score-display">0</div>
    <div class="game-area"><div class="sun-main" id="sun-btn"></div></div>
</div>

<div id="mission-panel" class="view-panel">
    <h2 id="t-mission-head" style="color: var(--text-gold);">Missions</h2>
    <div class="card-item"><div><b>X (Twitter)</b><br><small>+10,000</small></div><button class="btn-buy" onclick="completeMission(10000)">GO</button></div>
    <div class="card-item"><div><b>Telegram</b><br><small>+20,000</small></div><button class="btn-buy" onclick="completeMission(20000)">JOIN</button></div>
</div>

<div id="boost-panel" class="view-panel">
    <h2 id="t-boost-head" style="color: var(--text-gold);">Boosts</h2>
    <div class="card-item" onclick="tryCombo('‚òÄÔ∏è')"><div><b id="t-boost-1">Panneau Solaire</b><br><small>Combo Item 1</small></div><button class="btn-buy" onclick="buy(1000)">1,000</button></div>
    <div class="card-item" onclick="tryCombo('üíé')"><div><b id="t-boost-2">Cristal</b><br><small>Combo Item 2</small></div><button class="btn-buy" onclick="buy(5000)">5,000</button></div>
    <div class="card-item" onclick="tryCombo('üî•')"><div><b id="t-boost-3">Nucl√©aire</b><br><small>Combo Item 3</small></div><button class="btn-buy" onclick="buy(10000)">10,000</button></div>
</div>

<div id="ref-panel" class="view-panel">
    <h2 id="t-ref-head" style="color: var(--text-gold);">Amis</h2>
    <p id="t-ref-sub">Invitez et gagnez 50,000 $SHINE !</p>
    <div style="background:#000; padding:20px; border-radius:15px; border:1px dashed var(--text-gold); text-align:center;">
        <button class="btn-action" id="t-btn-share" onclick="shareToTelegram()">üì¢ INVITER DES AMIS</button>
        <button class="btn-action" id="t-btn-copy" style="background:#333; color:white;" onclick="copyLink()">üìã COPIER LE LIEN</button>
    </div>
</div>

<div class="footer-nav">
    <div class="nav-btn active" id="nav-game" onclick="showView('game')">üè†<br><span id="t-nav-play">Jouer</span></div>
    <div class="nav-btn" id="nav-mission" onclick="showView('mission')">üöÄ<br><span id="t-nav-miss">Missions</span></div>
    <div class="nav-btn" id="nav-boost" onclick="showView('boost')">üí∞<br><span id="t-nav-boost">Boosts</span></div>
    <div class="nav-btn" id="nav-ref" onclick="showView('ref')">üë•<br><span id="t-nav-ref">Amis</span></div>
</div>

<script>
    const translations = {
        fr: {
            combo: "COMBO QUOTIDIEN (+5,000,000)", mission: "Missions", boost: "Boosts", 
            friends: "Amis", sub_ref: "Invitez et gagnez 50,000 $SHINE !", btn_share: "üì¢ INVITER DES AMIS",
            btn_copy: "üìã COPIER LE LIEN", nav_play: "Jouer", nav_miss: "Missions", nav_boost: "Boosts",
            nav_ref: "Amis", b1: "Panneau Solaire", b2: "Cristal", b3: "Nucl√©aire", win: "COMBO GAGNANT ! +5M", fail: "Rat√© !"
        },
        en: {
            combo: "DAILY COMBO (+5,000,000)", mission: "Tasks", boost: "Upgrades", 
            friends: "Friends", sub_ref: "Invite and get 50,000 $SHINE!", btn_share: "üì¢ INVITE FRIENDS",
            btn_copy: "üìã COPY LINK", nav_play: "Play", nav_miss: "Tasks", nav_boost: "Upgrades",
            nav_ref: "Friends", b1: "Solar Panel", b2: "Crystal", b3: "Nuclear", win: "WINNING COMBO! +5M", fail: "Failed!"
        }
    };

    function changeLanguage(lang) {
        const t = translations[lang];
        document.getElementById('t-combo-title').innerText = t.combo;
        document.getElementById('t-mission-head').innerText = t.mission;
        document.getElementById('t-boost-head').innerText = t.boost;
        document.getElementById('t-ref-head').innerText = t.friends;
        document.getElementById('t-ref-sub').innerText = t.sub_ref;
        document.getElementById('t-btn-share').innerText = t.btn_share;
        document.getElementById('t-btn-copy').innerText = t.btn_copy;
        document.getElementById('t-nav-play').innerText = t.nav_play;
        document.getElementById('t-nav-miss').innerText = t.nav_miss;
        document.getElementById('t-nav-boost').innerText = t.nav_boost;
        document.getElementById('t-nav-ref').innerText = t.nav_ref;
        document.getElementById('t-boost-1').innerText = t.b1;
        document.getElementById('t-boost-2').innerText = t.b2;
        document.getElementById('t-boost-3').innerText = t.b3;
        window.currentWinMsg = t.win; window.currentFailMsg = t.fail;
    }

    // FIREBASE CONFIG
    const firebaseConfig = {
        apiKey: "AIzaSyAHGs4Lcd-KefevIcsum5BwBHM9zimso0c",
        authDomain: "shinesungame.firebaseapp.com",
        projectId: "shinesungame",
        databaseURL: "https://shinesungame-default-rtdb.firebaseio.com",
        storageBucket: "shinesungame.firebasestorage.app",
        messagingSenderId: "716211150472",
        appId: "1:716211150472:web:ad27a69f590a9c7bfb893d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const tg = window.Telegram.WebApp;
    const botUsername = "ShineSunGold_bot";
    let user = tg.initDataUnsafe.user || { id: "dev_test", first_name: "Player", language_code: "fr" };
    let score = 0;
    let currentCombo = [];
    const targetCombo = ['‚òÄÔ∏è', 'üíé', 'üî•'];

    function init() {
        const userLang = user.language_code === 'en' ? 'en' : 'fr';
        document.getElementById('lang-picker').value = userLang;
        changeLanguage(userLang);

        db.ref('users/' + user.id).on('value', (snap) => {
            const data = snap.val();
            if(data) { score = data.score; updateUI(); }
            else { checkReferral(); db.ref('users/' + user.id).set({name: user.first_name, score: 0}); }
        });
    }

    function checkReferral() {
        const params = new URLSearchParams(window.location.search);
        const refId = params.get('tgWebAppStartParam');
        if(refId && refId !== user.id.toString()) {
            db.ref('users/' + refId + '/score').transaction(s => (s || 0) + 50000);
        }
    }

    function updateUI() { document.getElementById('score-display').innerText = Math.floor(score).toLocaleString(); }
    
    document.getElementById('sun-btn').addEventListener('click', () => {
        score++; updateUI(); db.ref('users/' + user.id).update({score: score});
    });

    function tryCombo(s) {
        if(currentCombo.length < 3) {
            currentCombo.push(s);
            document.getElementById(`slot-${currentCombo.length-1}`).innerText = s;
            document.getElementById(`slot-${currentCombo.length-1}`).classList.add('active');
            if(currentCombo.length === 3) {
                if(JSON.stringify(currentCombo) === JSON.stringify(targetCombo)) {
                    score += 5000000; alert(window.currentWinMsg);
                } else { alert(window.currentFailMsg); }
                currentCombo = [];
                setTimeout(() => { for(let i=0;i<3;i++) { 
                    document.getElementById(`slot-${i}`).innerText="?"; 
                    document.getElementById(`slot-${i}`).classList.remove('active'); 
                }}, 1000);
                db.ref('users/' + user.id).update({score: score});
            }
        }
    }

    function buy(cost) { if(score >= cost) { score -= cost; db.ref('users/' + user.id).update({score: score}); alert("OK!"); } }
    function completeMission(reward) { score += reward; db.ref('users/' + user.id).update({score: score}); alert("Success!"); }

    function shareToTelegram() {
        const url = `https://t.me/${botUsername}/myapp?startapp=${user.id}`;
        window.open(`https://t.me/share/url?url=${encodeURIComponent(url)}&text=Join me on ShineSun Gold! ‚òÄÔ∏è`);
    }

    function copyLink() {
        const url = `https://t.me/${botUsername}/myapp?startapp=${user.id}`;
        navigator.clipboard.writeText(url); alert("Lien copi√© / Link copied!");
    }

    function showView(v) {
        document.querySelectorAll('.view-panel').forEach(p => p.style.display = 'none');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if(v !== 'game') { document.getElementById(v + '-panel').style.display = 'block'; document.getElementById('nav-' + v).classList.add('active'); }
        else { document.getElementById('nav-game').classList.add('active'); }
    }

    window.onload = () => { tg.expand(); init(); };
</script>
</body>
</html>
