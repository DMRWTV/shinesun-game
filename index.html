<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ShineSun Gold - Global Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --sun-main: #fff700; --sun-bright: #ffffff; --bg-color: #0b0b0b; --card-bg: #1c1c1e; }
        body { background-color: var(--bg-color); color: white; font-family: 'Inter', sans-serif; margin: 0; padding: 0; user-select: none; overflow: hidden; touch-action: manipulation; }
        .app-container { display: flex; flex-direction: column; height: 100vh; padding: 20px; box-sizing: border-box; }
        .header-info { text-align: center; margin-top: 5px; }
        .energy-wrapper { width: 80%; max-width: 250px; margin: 10px auto; }
        .energy-bar-bg { width: 100%; height: 10px; background: #222; border-radius: 10px; overflow: hidden; border: 1px solid #333; }
        .energy-bar-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #fff700, #ffcc00); transition: width 0.2s; }
        .main-score { font-size: 48px; font-weight: 900; text-align: center; margin: 10px 0; color: white; }
        .game-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; position: relative; }
        .sun-main { width: 210px; height: 210px; background: radial-gradient(circle, var(--sun-bright) 0%, var(--sun-main) 50%, #ffcc00 100%); border-radius: 50%; cursor: pointer; transition: transform 0.05s; box-shadow: 0 0 50px #fff700, 0 0 100px rgba(255, 247, 0, 0.3); border: none; }
        .sun-main:active { transform: scale(0.92); }
        .view-panel { position: fixed; top: 0; left: 0; width: 100%; height: 88vh; background: var(--bg-color); z-index: 500; display: none; padding: 20px; box-sizing: border-box; overflow-y: auto; padding-bottom: 100px; }
        .card-item { background: var(--card-bg); padding: 15px; border-radius: 16px; margin-bottom: 12px; border: 1px solid #2c2c2e; display: flex; justify-content: space-between; align-items: center; }
        .btn-invite-main { background: var(--sun-main); border: none; padding: 15px; border-radius: 12px; font-weight: bold; color: black; cursor: pointer; width: 100%; font-size: 16px; margin-bottom: 10px; }
        .btn-buy { background: var(--sun-main); border: none; padding: 8px 12px; border-radius: 8px; font-weight: bold; color: black; cursor: pointer; min-width: 75px; }
        .btn-buy.owned { background: #444; color: #888; pointer-events: none; }
        .leader-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #222; font-size: 14px; }
        .footer-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #111; border-top: 1px solid #222; display: flex; justify-content: space-around; padding: 12px 0; z-index: 1000; }
        .nav-btn { color: #555; font-size: 10px; text-align: center; cursor: pointer; flex: 1; font-weight: bold; }
        .nav-btn.active { color: var(--sun-main); }
        /* Support for Arabic (RTL) */
        body.lang-ar { direction: rtl; }
    </style>
</head>
<body>

<div class="app-container" id="game-view">
    <div class="header-info">
        <div id="txt-combo" style="font-size: 10px; color: #666;">DAILY COMBO ???</div>
        <div class="energy-wrapper">
            <div class="energy-bar-bg"><div class="energy-bar-fill" id="energy-fill"></div></div>
            <div style="font-size: 10px; color: #aaa; margin-top: 4px;">âš¡ <span id="energy-val">1000</span>/1000</div>
        </div>
    </div>
    <div class="main-score" id="score-display">0</div>
    <div class="game-area"><div class="sun-main" id="sun-btn"></div></div>
</div>

<div id="leader-panel" class="view-panel">
    <h2 id="txt-friends-title" style="color: var(--sun-main);">Friends</h2>
    <div style="background: #1a1a1a; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 20px; border: 1px solid #333;">
        <div id="txt-invite-msg" style="font-size: 14px; font-weight: bold; margin-bottom: 15px;">Invite friends & earn 50k</div>
        <button id="txt-btn-invite" class="btn-invite-main" onclick="shareTelegram()">INVITE ğŸ‘¤</button>
    </div>
    <h3 id="txt-leader-title" style="color: var(--sun-main);">Top 10</h3>
    <div id="leader-list" style="background:#111; border-radius:15px; padding:10px; margin-bottom:20px;"></div>
    <h3 id="txt-mission-title">Missions</h3>
    <div id="missions-container"></div>
</div>

<div id="boost-panel" class="view-panel">
    <h2 id="txt-shop-title" style="color: var(--sun-main);">Shop</h2>
    <div id="shop-list"></div>
</div>

<div class="footer-nav">
    <div class="nav-btn active" id="nav-game" onclick="showView('game')">ğŸ <br><span id="txt-nav-play">PLAY</span></div>
    <div class="nav-btn" id="nav-leader" onclick="showView('leader')">ğŸ†<br><span id="txt-nav-friends">FRIENDS</span></div>
    <div class="nav-btn" id="nav-boost" onclick="showView('boost')">ğŸ’°<br><span id="txt-nav-shop">SHOP</span></div>
</div>

<script>
    const i18n = {
        en: { combo:"DAILY COMBO", play:"PLAY", friends:"FRIENDS", shop:"SHOP", invite_msg:"Invite friends & earn 50k $SHINE", btn_invite:"INVITE ğŸ‘¤", leader:"Top 10", mission:"Missions", buy:"BUY", owned:"OWNED", share:"Join me on ShineSun Gold!", upgrades:["Solar Panel", "Crystal", "Magma Pump", "Nuclear", "Flare", "Galaxy"] },
        fr: { combo:"COMBO DU JOUR", play:"JOUER", friends:"AMIS", shop:"BOUTIQUE", invite_msg:"Invite tes amis et gagne 50k $SHINE", btn_invite:"INVITER ğŸ‘¤", leader:"Top 10", mission:"Missions", buy:"ACHETER", owned:"ACQUIS", share:"Rejoins-moi sur ShineSun Gold !", upgrades:["Panneau Solaire", "Cristal", "Pompe Magma", "NuclÃ©aire", "Ã‰ruption", "Galactique"] },
        es: { combo:"COMBO DIARIO", play:"JUGAR", friends:"AMIGOS", shop:"TIENDA", invite_msg:"Â¡Invita amigos y gana 50k!", btn_invite:"INVITAR ğŸ‘¤", leader:"Top 10", mission:"Misiones", buy:"COMPRAR", owned:"PROPIO", share:"Â¡Ãšnete a mÃ­ en ShineSun Gold!", upgrades:["Panel Solar", "Cristal", "Bomba Magma", "Nuclear", "Llamarada", "Galaxia"] },
        de: { combo:"TÃ„GLICHER COMBO", play:"SPIELEN", friends:"FREUNDE", shop:"SHOP", invite_msg:"Freunde einladen & 50k verdienen", btn_invite:"EINLADEN ğŸ‘¤", leader:"Top 10", mission:"Missionen", buy:"KAUFEN", owned:"GEKAUFT", share:"Komm zu ShineSun Gold!", upgrades:["Solarpanel", "Kristall", "Magmapumpe", "Atomkern", "Flare", "Galaxie"] },
        ru: { combo:"Ğ”ĞĞ•Ğ’ĞĞĞ• ĞšĞĞœĞ‘Ğ", play:"Ğ˜Ğ“Ğ ĞĞ¢Ğ¬", friends:"Ğ”Ğ Ğ£Ğ—Ğ¬Ğ¯", shop:"ĞœĞĞ“ĞĞ—Ğ˜Ğ", invite_msg:"ĞŸÑ€Ğ¸Ğ³Ğ»Ğ°ÑĞ¸ Ğ´Ñ€ÑƒĞ·ĞµĞ¹ Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸ 50k", btn_invite:"ĞŸĞ Ğ˜Ğ“Ğ›ĞĞ¡Ğ˜Ğ¢Ğ¬ ğŸ‘¤", leader:"Ğ¢Ğ¾Ğ¿ 10", mission:"Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ", buy:"ĞšĞ£ĞŸĞ˜Ğ¢Ğ¬", owned:"ĞšĞ£ĞŸĞ›Ğ•ĞĞ", share:"ĞŸÑ€Ğ¸ÑĞ¾ĞµĞ´Ğ¸Ğ½ÑĞ¹ÑÑ Ğº ShineSun Gold!", upgrades:["Ğ¡Ğ¾Ğ»Ğ½ĞµÑ‡Ğ½Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ", "ĞšÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ»", "ĞœĞ°Ğ³Ğ¼Ğ° Ğ½Ğ°ÑĞ¾Ñ", "Ğ¯Ğ´Ñ€Ğ¾", "Ğ’ÑĞ¿Ñ‹ÑˆĞºĞ°", "Ğ“Ğ°Ğ»Ğ°ĞºÑ‚Ğ¸ĞºĞ°"] },
        pt: { combo:"COMBO DIÃRIO", play:"JOGAR", friends:"AMIGOS", shop:"LOJA", invite_msg:"Convide amigos e ganhe 50k", btn_invite:"CONVIDAR ğŸ‘¤", leader:"Top 10", mission:"MissÃµes", buy:"COMPRAR", owned:"ADQUIRIDO", share:"Junte-se a mim no ShineSun Gold!", upgrades:["Painel Solar", "Cristal", "Bomba Magma", "Nuclear", "ExplosÃ£o", "GalÃ¡xia"] },
        it: { combo:"COMBO GIORNALIERO", play:"GIOCA", friends:"AMICI", shop:"NEGOZIO", invite_msg:"Invita amici e guadagna 50k", btn_invite:"INVITA ğŸ‘¤", leader:"Top 10", mission:"Missioni", buy:"COMPRA", owned:"ACQUISTATO", share:"Unisciti a me su ShineSun Gold!", upgrades:["Pannello Solare", "Cristallo", "Pompa Magma", "Nucleare", "Flare", "Galassia"] },
        ar: { combo:"ÙƒÙˆÙ…Ø¨Ùˆ Ø§Ù„ÙŠÙˆÙ…", play:"Ù„Ø¹Ø¨", friends:"Ø£ØµØ¯Ù‚Ø§Ø¡", shop:"Ù…ØªØ¬Ø±", invite_msg:"Ø§Ø¯Ø¹Ù Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ÙˆØ§Ø±Ø¨Ø­ 50 Ø£Ù„Ù", btn_invite:"Ø¯Ø¹ÙˆØ© ğŸ‘¤", leader:"Ø£ÙØ¶Ù„ 10", mission:"Ù…Ù‡Ø§Ù…", buy:"Ø´Ø±Ø§Ø¡", owned:"ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡", share:"Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠ ÙÙŠ ShineSun Gold!", upgrades:["Ù„ÙˆØ­Ø© Ø´Ù…Ø³ÙŠØ©", "ÙƒØ±ÙŠØ³ØªØ§Ù„", "Ù…Ø¶Ø®Ø© Ù…Ø§ØºÙ…Ø§", "Ù†ÙˆÙˆÙŠ", "ØªÙˆÙ‡Ø¬", "Ù…Ø¬Ø±Ø©"] }
    };

    const userLang = (window.navigator.language || 'en').split('-')[0];
    const texts = i18n[userLang] || i18n.en;
    if(userLang === 'ar') document.body.classList.add('lang-ar');

    const firebaseConfig = {
        apiKey: "AIzaSyAHGs4Lcd-KefevIcsum5BwBHM9zimso0c",
        authDomain: "shinesungame.firebaseapp.com",
        projectId: "shinesungame",
        databaseURL: "https://shinesungame-default-rtdb.europe-west1.firebasedatabase.app/",
        storageBucket: "shinesungame.firebasestorage.app",
        messagingSenderId: "716211150472",
        appId: "1:716211150472:web:ad27a69f590a9c7bfb893d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const tg = window.Telegram.WebApp;
    
    let user = tg.initDataUnsafe.user || { id: "dev_user", first_name: "Player" };
    let score = 0, energy = 1000, ownedItems = {}, completedMissions = {};
    
    const upgrades = [
        {id:'u1', boost:2, price:1000, icon:'â˜€ï¸'}, {id:'u2', boost:5, price:5000, icon:'ğŸ’'},
        {id:'u3', boost:10, price:15000, icon:'ğŸŒ‹'}, {id:'u4', boost:25, price:50000, icon:'ğŸ”¥'},
        {id:'u5', boost:60, price:150000, icon:'ğŸ’¥'}, {id:'u6', boost:150, price:500000, icon:'ğŸŒŒ'}
    ];

    function applyLang() {
        document.getElementById('txt-combo').innerText = texts.combo;
        document.getElementById('txt-nav-play').innerText = texts.play;
        document.getElementById('txt-nav-friends').innerText = texts.friends;
        document.getElementById('txt-nav-shop').innerText = texts.shop;
        document.getElementById('txt-friends-title').innerText = texts.friends;
        document.getElementById('txt-invite-msg').innerText = texts.invite_msg;
        document.getElementById('txt-btn-invite').innerText = texts.btn_invite;
        document.getElementById('txt-leader-title').innerText = texts.leader;
        document.getElementById('txt-mission-title').innerText = texts.mission;
        document.getElementById('txt-shop-title').innerText = texts.shop;
        
        document.getElementById('missions-container').innerHTML = `
            <div class="card-item"><div><b>TikTok</b></div><button class="btn-buy" onclick="completeMission('tt',20000,'https://tiktok.com/@shinesungold')">GO</button></div>
            <div class="card-item"><div><b>Telegram</b></div><button class="btn-buy" onclick="completeMission('tg',15000,'https://t.me/shinesun_gold')">JOIN</button></div>
            <div class="card-item"><div><b>X (Twitter)</b></div><button class="btn-buy" onclick="completeMission('x',10000,'https://x.com/shinesun_gold')">X</button></div>`;
    }

    function init() {
        applyLang();
        db.ref('users/' + user.id).on('value', (snap) => {
            const d = snap.val() || {};
            score = d.score || 0; ownedItems = d.ownedItems || {}; completedMissions = d.completedMissions || {};
            renderShop(); updateUI();
        });
        const startParam = tg.initDataUnsafe.start_param;
        if (startParam && startParam !== user.id.toString()) {
            db.ref('referrals/' + user.id).once('value', (s) => {
                if(!s.exists()) {
                    db.ref('users/' + startParam).child('score').transaction(s => (s||0) + 50000);
                    db.ref('referrals/' + user.id).set(startParam);
                }
            });
        }
        loadLeaderboard();
        setInterval(() => { if(energy < 1000) { energy += 3; updateEnergyUI(); }}, 1000);
    }

    function shareTelegram() {
        const link = `https://t.me/shinesungame_bot?start=${user.id}`;
        const shareUrl = `https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(texts.share)}`;
        tg.openTelegramLink(shareUrl);
    }

    function loadLeaderboard() {
        db.ref('users').orderByChild('score').limitToLast(10).on('value', (snap) => {
            let html = ''; let users = [];
            snap.forEach(c => { users.push(c.val()); });
            users.reverse().forEach((u, i) => {
                html += `<div class="leader-row"><span>#${i+1} ${u.name}</span><b>${Math.floor(u.score).toLocaleString()}</b></div>`;
            });
            document.getElementById('leader-list').innerHTML = html;
        });
    }

    function renderShop() {
        let h = ''; upgrades.forEach((u, i) => {
            const owned = ownedItems[u.id];
            h += `<div class="card-item"><div><b>${u.icon} ${texts.upgrades[i]}</b><br><small>+${u.boost}</small></div>
            <button class="btn-buy ${owned?'owned':''}" onclick="buy('${u.id}',${u.price})">${owned?texts.owned:u.price.toLocaleString()}</button></div>`;
        });
        document.getElementById('shop-list').innerHTML = h;
    }

    function buy(id, p) { if(score >= p && !ownedItems[id]) { score -= p; ownedItems[id] = true; save(); } }
    document.getElementById('sun-btn').onclick = (e) => {
        if(energy < 1) return;
        let tap = 1; upgrades.forEach(u => { if(ownedItems[u.id]) tap += u.boost; });
        score += tap; energy -= 1; updateEnergyUI(); save();
        showPop(e, tap); tg.HapticFeedback.impactOccurred('medium');
    };
    function save() { db.ref('users/' + user.id).update({score, ownedItems, completedMissions, name: user.first_name}); }
    function completeMission(id, r, l) { window.open(l, '_blank'); setTimeout(() => { if(!completedMissions[id]) { score += r; completedMissions[id] = true; save(); }}, 3000); }
    function showView(v) { document.querySelectorAll('.view-panel').forEach(p => p.style.display = 'none'); document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active')); if(v !== 'game') document.getElementById(v + '-panel').style.display = 'block'; document.getElementById('nav-' + v).classList.add('active'); }
    function updateUI() { document.getElementById('score-display').innerText = Math.floor(score).toLocaleString(); }
    function updateEnergyUI() { document.getElementById('energy-fill').style.width = (energy/10) + '%'; document.getElementById('energy-val').innerText = Math.floor(energy); }
    function showPop(e, t) {
        const f = document.createElement('div'); f.innerText = '+' + t;
        f.style.cssText = `position:absolute; left:${e.clientX}px; top:${e.clientY}px; color:var(--sun-main); font-weight:900; font-size:30px; pointer-events:none; z-index:2000;`;
        f.animate([{transform:'translateY(0)', opacity:1}, {transform:'translateY(-100px)', opacity:0}], 600);
        document.body.appendChild(f); setTimeout(() => f.remove(), 600);
    }
    window.onload = () => { tg.expand(); init(); };
</script>
</body>
</html>
