<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ShineSun Gold - Europe Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --sun-gradient: linear-gradient(180deg, #FFD700 0%, #FF8C00 100%); --bg-color: #0b0b0b; --card-bg: #1c1c1e; --text-gold: #FFD700; }
        body { background-color: var(--bg-color); color: white; font-family: 'Inter', sans-serif; margin: 0; padding: 0; user-select: none; overflow: hidden; }
        .app-container { display: flex; flex-direction: column; height: 100vh; padding: 20px; box-sizing: border-box; }
        .lang-select { position: fixed; top: 10px; right: 10px; background: #222; color: white; border: 1px solid var(--text-gold); border-radius: 5px; z-index: 2000; font-size: 10px; padding: 5px; }
        .header-info { text-align: center; margin-top: 25px; }
        .combo-container { display: flex; justify-content: center; gap: 8px; margin: 10px 0; }
        .combo-slot { width: 40px; height: 40px; background: #222; border: 2px dashed #444; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .combo-slot.active { border-color: var(--text-gold); background: var(--card-bg); border-style: solid; }
        .main-score { font-size: 40px; font-weight: 900; text-align: center; margin: 10px 0; color: var(--text-gold); }
        .game-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; }
        .sun-main { width: 170px; height: 170px; background: var(--sun-gradient); border-radius: 50%; box-shadow: 0 0 50px rgba(255, 140, 0, 0.4); cursor: pointer; transition: transform 0.05s; border: 8px solid rgba(255,255,255,0.1); }
        .sun-main:active { transform: scale(0.92); }
        .footer-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #151515; border-top: 1px solid #333; display: flex; justify-content: space-around; padding: 12px 0; z-index: 1000; }
        .nav-btn { color: #666; font-size: 9px; text-align: center; cursor: pointer; flex: 1; text-transform: uppercase; }
        .nav-btn.active { color: var(--text-gold); font-weight: bold; }
        .view-panel { position: fixed; top: 0; left: 0; width: 100%; height: 88vh; background: var(--bg-color); z-index: 500; display: none; padding: 20px; box-sizing: border-box; overflow-y: auto; padding-bottom: 100px; }
        .card-item { background: var(--card-bg); padding: 12px; border-radius: 14px; margin-bottom: 10px; border: 1px solid #2c2c2e; display: flex; justify-content: space-between; align-items: center; }
        .btn-buy { background: var(--text-gold); border: none; padding: 8px 10px; border-radius: 8px; font-weight: bold; color: black; font-size: 11px; }
        .btn-buy.owned { background: #444; color: #888; }
        .leader-row { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #222; font-size: 13px; }
        .rank-num { color: var(--text-gold); font-weight: bold; margin-right: 10px; }
    </style>
</head>
<body>

<select class="lang-select" id="lang-picker" onchange="changeLanguage(this.value)">
    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
    <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
    <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
    <option value="sq">ğŸ‡¦ğŸ‡± Shqip</option>
    <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
    <option value="pl">ğŸ‡µğŸ‡± Polski</option>
    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
</select>

<div class="app-container" id="game-view">
    <div class="header-info">
        <div id="t-combo-text" style="font-size: 10px; color: #888;">DAILY COMBO ???</div>
        <div class="combo-container">
            <div class="combo-slot" id="slot-0">?</div>
            <div class="combo-slot" id="slot-1">?</div>
            <div class="combo-slot" id="slot-2">?</div>
        </div>
    </div>
    <div class="main-score" id="score-display">0</div>
    <div class="game-area"><div class="sun-main" id="sun-btn"></div></div>
</div>

<div id="leader-panel" class="view-panel">
    <h2 id="t-lead-head" style="color: var(--text-gold); margin-bottom:10px;">Global Ranking</h2>
    <div id="leader-list" style="background:#111; border-radius:15px; padding:10px; margin-bottom:30px; max-height:200px; overflow-y:auto;">Loading...</div>
    
    <h2 id="t-nav-4" style="color: var(--text-gold); margin-bottom:10px;">Missions</h2>
    <div class="card-item"><div><b>X (Twitter)</b><br><small>+10,000</small></div><button class="btn-buy" onclick="completeMission(10000)">GO</button></div>
    <div class="card-item"><div><b>Telegram</b><br><small>+15,000</small></div><button class="btn-buy" onclick="completeMission(15000)">JOIN</button></div>
</div>

<div id="boost-panel" class="view-panel">
    <h2 id="t-boost-head" style="color: var(--text-gold);">Upgrades</h2>
    <div class="card-item">
        <div><b>Solar Panel</b><br><small id="t-up-1">Buy to use</small></div>
        <div>
            <button id="btn-â˜€ï¸" class="btn-buy" onclick="buy('â˜€ï¸', 1000)">1,000</button>
            <button class="btn-buy" style="background:#555;" onclick="tryCombo('â˜€ï¸')">USE</button>
        </div>
    </div>
    <div class="card-item">
        <div><b>Crystal Focus</b><br><small id="t-up-2">Buy to use</small></div>
        <div>
            <button id="btn-ğŸ’" class="btn-buy" onclick="buy('ğŸ’', 5000)">5,000</button>
            <button class="btn-buy" style="background:#555;" onclick="tryCombo('ğŸ’')">USE</button>
        </div>
    </div>
    <div class="card-item">
        <div><b>Nuclear Core</b><br><small id="t-up-3">Buy to use</small></div>
        <div>
            <button id="btn-ğŸ”¥" class="btn-buy" onclick="buy('ğŸ”¥', 15000)">15,000</button>
            <button class="btn-buy" style="background:#555;" onclick="tryCombo('ğŸ”¥')">USE</button>
        </div>
    </div>
</div>

<div class="footer-nav">
    <div class="nav-btn active" id="nav-game" onclick="showView('game')">ğŸ <br><span id="t-nav-1">Play</span></div>
    <div class="nav-btn" id="nav-leader" onclick="showView('leader')">ğŸ†<br><span id="t-nav-2">Rank/Tasks</span></div>
    <div class="nav-btn" id="nav-boost" onclick="showView('boost')">ğŸ’°<br><span id="t-nav-3">Upgrades</span></div>
</div>

<script>
    const translations = {
        en: { play: "Play", rank: "Rank/Tasks", up: "Upgrades", buy: "Buy to use", win: "WINNER! +5M", fail: "WRONG! Items lost.", need: "Buy it first!", combo: "DAILY COMBO ???", miss: "Missions" },
        fr: { play: "Jouer", rank: "Classement/Missions", up: "Boosts", buy: "Acheter pour utiliser", win: "GAGNÃ‰ ! +5M", fail: "FAUX ! Objets perdus.", need: "Achetez-le d'abord !", combo: "COMBO DU JOUR ???", miss: "Missions" },
        es: { play: "Jugar", rank: "Ranking/Tareas", up: "Mejoras", buy: "Comprar para usar", win: "Â¡GANASTE! +5M", fail: "Â¡ERROR! Objetos perdidos.", need: "Â¡CÃ³mpralo primero!", combo: "COMBO DIARIO ???", miss: "Misiones" },
        pt: { play: "Jogar", rank: "Ranking/MissÃµes", up: "Melhorias", buy: "Comprar para usar", win: "GANHOU! +5M", fail: "ERRO! Itens perdidos.", need: "Compre primeiro!", combo: "COMBO DIÃRIO ???", miss: "MissÃµes" },
        it: { play: "Gioca", rank: "Classifica/Missioni", up: "Potenziamenti", buy: "Compra per usare", win: "VINTO! +5M", fail: "ERRORE! Oggetti persi.", need: "Compralo prima!", combo: "COMBO GIORNALIERO ???", miss: "Missioni" },
        de: { play: "Spielen", rank: "Ranking/Aufgaben", up: "Upgrades", buy: "Kaufen zum Benutzen", win: "GEWONNEN! +5M", fail: "FALSCH! Items weg.", need: "Zuerst kaufen!", combo: "TÃ„GLICHER COMBO ???", miss: "Aufgaben" },
        sq: { play: "Luaj", rank: "Renditja/Misionet", up: "PÃ«rmirÃ«sime", buy: "Bli pÃ«r tÃ« pÃ«rdorur", win: "FITORE! +5M", fail: "GABIM! HumbÃ«t sendet.", need: "Blije sÃ« pari!", combo: "KOMBO DITOR ???", miss: "Misionet" },
        tr: { play: "Oyna", rank: "SÄ±ralama/GÃ¶revler", up: "YÃ¼kseltme", buy: "Kullanmak iÃ§in al", win: "KAZANDIN! +5M", fail: "YANLIÅ! EÅŸyalar gitti.", need: "Ã–nce satÄ±n al!", combo: "GÃœNLÃœK KOMBO ???", miss: "GÃ¶revler" },
        zh: { play: "å¼€å§‹æ¸¸æˆ", rank: "æ’è¡Œæ¦œ/ä»»åŠ¡", up: "å‡çº§", buy: "è´­ä¹°åä½¿ç”¨", win: "è·èƒœï¼+5M", fail: "é”™è¯¯ï¼ç‰©å“ä¸¢å¤±ã€‚", need: "å…ˆè´­ä¹°ï¼", combo: "æ¯æ—¥ç»„åˆ ???", miss: "ä»»åŠ¡" },
        ja: { play: "ãƒ—ãƒ¬ã‚¤", rank: "ãƒ©ãƒ³ã‚¯/ãƒŸãƒƒã‚·ãƒ§ãƒ³", up: "ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰", buy: "è³¼å…¥ã—ã¦ä½¿ç”¨", win: "å‹åˆ©ï¼+5M", fail: "å¤±æ•—ï¼ã‚¢ã‚¤ãƒ†ãƒ ç´›å¤±ã€‚", need: "ã¾ãšè³¼å…¥ã—ã¦ãã ã•ã„ï¼", combo: "ãƒ‡ã‚¤ãƒªãƒ¼ã‚³ãƒ³ãƒœ ???", miss: "ãƒŸãƒƒã‚·ãƒ§ãƒ³" },
        pl: { play: "Graj", rank: "Ranking/Misje", up: "Ulepszenia", buy: "Kup, aby uÅ¼yÄ‡", win: "WYGRANA! +5M", fail: "BÅÄ„D! Przedmioty stracone.", need: "Kup najpierw!", combo: "DZIENNE COMBO ???", miss: "Misje" },
        ru: { play: "Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ", rank: "Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³/Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ", up: "Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ", buy: "ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ñ‹", win: "ĞŸĞĞ‘Ğ•Ğ”Ğ! +5M", fail: "ĞĞ¨Ğ˜Ğ‘ĞšĞ! Ğ’ĞµÑ‰Ğ¸ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ½Ñ‹.", need: "Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ĞºÑƒĞ¿Ğ¸Ñ‚Ğµ!", combo: "ĞšĞĞœĞ‘Ğ Ğ”ĞĞ¯ ???", miss: "Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ" }
    };

    function changeLanguage(lang) {
        const t = translations[lang] || translations['en'];
        document.getElementById('t-nav-1').innerText = t.play;
        document.getElementById('t-nav-2').innerText = t.rank;
        document.getElementById('t-nav-3').innerText = t.up;
        document.getElementById('t-nav-4').innerText = t.miss;
        document.getElementById('t-combo-text').innerText = t.combo;
        document.getElementById('t-lead-head').innerText = t.rank.split('/')[0];
        document.getElementById('t-boost-head').innerText = t.up;
        document.getElementById('t-up-1').innerText = t.buy;
        document.getElementById('t-up-2').innerText = t.buy;
        document.getElementById('t-up-3').innerText = t.buy;
        window.msgWin = t.win; window.msgFail = t.fail; window.msgNeed = t.need;
    }

    const firebaseConfig = {
        apiKey: "AIzaSyAHGs4Lcd-KefevIcsum5BwBHM9zimso0c",
        authDomain: "shinesungame.firebaseapp.com",
        projectId: "shinesungame",
        databaseURL: "https://shinesungame-default-rtdb.europe-west1.firebasedatabase.app/",
        storageBucket: "shinesungame.firebasestorage.app",
        messagingSenderId: "716211150472",
        appId: "1:716211150472:web:ad27a69f590a9c7bfb893d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const tg = window.Telegram.WebApp;
    let user = tg.initDataUnsafe.user || { id: "test_dev", first_name: "Explorer" };
    let score = 0; let ownedItems = {}; let currentCombo = []; let lastDate = "";
    const target = ['â˜€ï¸', 'ğŸ’', 'ğŸ”¥'];

    function init() {
        changeLanguage('en');
        db.ref('users/' + user.id).on('value', (snap) => {
            const d = snap.val();
            if(d) { score = d.score; ownedItems = d.ownedItems || {}; lastDate = d.lastDate || ""; updateUI(); }
            else { db.ref('users/' + user.id).set({name: user.first_name, score: 0}); }
        });
        loadLeaderboard();
    }

    function loadLeaderboard() {
        db.ref('users').orderByChild('score').limitToLast(20).on('value', (snap) => {
            let html = ''; let players = [];
            snap.forEach(child => { players.push(child.val()); });
            players.reverse().forEach((p, i) => {
                html += `<div class="leader-row"><span class="rank-num">#${i+1}</span> <span>${p.name || 'Player'}</span> <span style="color:gold">${Math.floor(p.score).toLocaleString()}</span></div>`;
            });
            document.getElementById('leader-list').innerHTML = html || 'No data';
        });
    }

    function updateUI() {
        document.getElementById('score-display').innerText = Math.floor(score).toLocaleString();
        ['â˜€ï¸', 'ğŸ’', 'ğŸ”¥'].forEach(item => {
            const b = document.getElementById('btn-' + item);
            if(ownedItems[item]) { b.innerText = "OWN"; b.classList.add('owned'); }
            else { b.classList.remove('owned'); b.innerText = (item==='â˜€ï¸'?'1K':item==='ğŸ’'?'5K':'15K'); }
        });
    }

    document.getElementById('sun-btn').onclick = () => { score++; updateUI(); db.ref('users/' + user.id).update({score: score}); };

    function buy(item, cost) {
        if(ownedItems[item]) return;
        if(score >= cost) {
            score -= cost; ownedItems[item] = true;
            db.ref('users/' + user.id).update({score: score, ownedItems: ownedItems});
        }
    }

    function completeMission(reward) {
        score += reward; db.ref('users/' + user.id).update({score: score}); alert("Success!");
    }

    function tryCombo(s) {
        const today = new Date().toISOString().split('T')[0];
        if(lastDate === today) return;
        if(!ownedItems[s]) { alert(window.msgNeed); return; }
        currentCombo.push(s);
        document.getElementById(`slot-${currentCombo.length-1}`).innerText = s;
        document.getElementById(`slot-${currentCombo.length-1}`).classList.add('active');
        if(currentCombo.length === 3) {
            if(JSON.stringify(currentCombo) === JSON.stringify(target)) {
                score += 5000000; lastDate = today; alert(window.msgWin);
            } else { alert(window.msgFail); }
            ownedItems = {}; currentCombo = [];
            db.ref('users/' + user.id).update({score: score, lastDate: lastDate, ownedItems: ownedItems});
            setTimeout(() => { for(let i=0;i<3;i++){document.getElementById(`slot-${i}`).innerText="?"; document.getElementById(`slot-${i}`).classList.remove('active');}}, 800);
        }
    }

    function showView(v) {
        document.querySelectorAll('.view-panel').forEach(p => p.style.display = 'none');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if(v !== 'game') { document.getElementById(v + '-panel').style.display = 'block'; document.getElementById('nav-' + v).classList.add('active'); }
        else { document.getElementById('nav-game').classList.add('active'); }
    }
    window.onload = () => { tg.expand(); init(); };
</script>
</body>
</html>
