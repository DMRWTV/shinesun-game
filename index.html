<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ShineSun Gold - Global Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --sun-main: #fff700; --sun-bright: #ffffff; --bg-color: #0b0b0b; --card-bg: #1c1c1e; }
        body { background-color: var(--bg-color); color: white; font-family: 'Inter', sans-serif; margin: 0; padding: 0; user-select: none; overflow: hidden; touch-action: manipulation; }
        .app-container { display: flex; flex-direction: column; height: 100vh; padding: 20px; box-sizing: border-box; }
        .header-info { text-align: center; margin-top: 5px; }
        .energy-wrapper { width: 80%; max-width: 250px; margin: 10px auto; }
        .energy-bar-bg { width: 100%; height: 10px; background: #222; border-radius: 10px; overflow: hidden; border: 1px solid #333; }
        .energy-bar-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #fff700, #ffcc00); transition: width 0.2s; }
        .main-score { font-size: 48px; font-weight: 900; text-align: center; margin: 10px 0; color: white; }
        .game-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; position: relative; }
        .sun-main { width: 210px; height: 210px; background: radial-gradient(circle, var(--sun-bright) 0%, var(--sun-main) 50%, #ffcc00 100%); border-radius: 50%; cursor: pointer; transition: transform 0.05s; box-shadow: 0 0 50px #fff700, 0 0 100px rgba(255, 247, 0, 0.3); border: none; }
        .sun-main:active { transform: scale(0.92); }
        .view-panel { position: fixed; top: 0; left: 0; width: 100%; height: 88vh; background: var(--bg-color); z-index: 500; display: none; padding: 20px; box-sizing: border-box; overflow-y: auto; padding-bottom: 100px; }
        .card-item { background: var(--card-bg); padding: 15px; border-radius: 16px; margin-bottom: 12px; border: 1px solid #2c2c2e; display: flex; justify-content: space-between; align-items: center; }
        .btn-invite-main { background: var(--sun-main); border: none; padding: 15px; border-radius: 12px; font-weight: bold; color: black; cursor: pointer; width: 100%; font-size: 16px; margin-bottom: 10px; }
        .btn-buy { background: var(--sun-main); border: none; padding: 8px 12px; border-radius: 8px; font-weight: bold; color: black; cursor: pointer; min-width: 75px; }
        .btn-buy.owned { background: #444; color: #888; pointer-events: none; }
        .leader-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #222; font-size: 14px; }
        .footer-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #111; border-top: 1px solid #222; display: flex; justify-content: space-around; padding: 12px 0; z-index: 1000; }
        .nav-btn { color: #555; font-size: 10px; text-align: center; cursor: pointer; flex: 1; font-weight: bold; }
        .nav-btn.active { color: var(--sun-main); }
    </style>
</head>
<body>

<div class="app-container" id="game-view">
    <div class="header-info">
        <div id="txt-combo" style="font-size: 10px; color: #666;">DAILY COMBO ???</div>
        <div class="energy-wrapper">
            <div class="energy-bar-bg"><div class="energy-bar-fill" id="energy-fill"></div></div>
            <div style="font-size: 10px; color: #aaa; margin-top: 4px;">‚ö° <span id="energy-val">1000</span>/1000</div>
        </div>
    </div>
    <div class="main-score" id="score-display">0</div>
    <div class="game-area"><div class="sun-main" id="sun-btn"></div></div>
</div>

<div id="leader-panel" class="view-panel">
    <h2 id="txt-friends-title" style="color: var(--sun-main);">Friends & Ranking</h2>
    <div style="background: #1a1a1a; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 20px; border: 1px solid #333;">
        <div id="txt-invite-msg" style="font-size: 14px; font-weight: bold; margin-bottom: 15px;">Invite friends & earn 50k $SHINE</div>
        <button id="txt-btn-invite" class="btn-invite-main" onclick="shareTelegram()">INVITE A FRIEND üë§</button>
    </div>
    <h3 id="txt-leader-title" style="color: var(--sun-main);">Top 10 Players</h3>
    <div id="leader-list" style="background:#111; border-radius:15px; padding:10px; margin-bottom:20px;">Loading...</div>
    <h3 id="txt-mission-title">Missions</h3>
    <div id="missions-container"></div>
</div>

<div id="boost-panel" class="view-panel">
    <h2 id="txt-shop-title" style="color: var(--sun-main);">Upgrades Shop</h2>
    <div id="shop-list"></div>
</div>

<div class="footer-nav">
    <div class="nav-btn active" id="nav-game" onclick="showView('game')">üè†<br><span id="txt-nav-play">PLAY</span></div>
    <div class="nav-btn" id="nav-leader" onclick="showView('leader')">üèÜ<br><span id="txt-nav-friends">FRIENDS</span></div>
    <div class="nav-btn" id="nav-boost" onclick="showView('boost')">üí∞<br><span id="txt-nav-shop">SHOP</span></div>
</div>

<script>
    // --- TRANSLATIONS ---
    const i18n = {
        en: {
            combo: "DAILY COMBO ???", play: "PLAY", friends: "FRIENDS", shop: "SHOP",
            friends_title: "Friends & Ranking", invite_msg: "Invite friends & earn 50k $SHINE",
            btn_invite: "INVITE A FRIEND üë§", leader_title: "Top 10 Players", missions: "Missions",
            shop_title: "Upgrades Shop", loading: "Loading...", btn_go: "GO", btn_join: "JOIN",
            btn_follow: "FOLLOW", btn_buy: "BUY", owned: "OWNED", alert_copy: "Link copied!",
            share_msg: "Join me on ShineSun Gold and earn 50k $SHINE! ‚òÄÔ∏è",
            upgrades: ["Solar Panel", "Crystal Focus", "Magma Pump", "Nuclear Core", "Solar Flare", "Galaxy Gate"]
        },
        fr: {
            combo: "COMBO QUOTIDIEN ???", play: "JOUER", friends: "AMIS", shop: "BOUTIQUE",
            friends_title: "Amis et Classement", invite_msg: "Invite des amis et gagne 50k $SHINE",
            btn_invite: "INVITER UN AMI üë§", leader_title: "Top 10 Joueurs", missions: "Missions",
            shop_title: "Boutique d'am√©liorations", loading: "Chargement...", btn_go: "C'EST PARTI", btn_join: "REJOINDRE",
            btn_follow: "SUIVRE", btn_buy: "ACHETER", owned: "ACQUIS", alert_copy: "Lien copi√© !",
            share_msg: "Rejoins-moi sur ShineSun Gold et gagne 50k $SHINE ! ‚òÄÔ∏è",
            upgrades: ["Panneau Solaire", "Focus Cristal", "Pompe √† Magma", "Noyau Nucl√©aire", "√âruption Solaire", "Porte Galactique"]
        }
    };

    const lang = (window.navigator.language || 'en').split('-')[0];
    const texts = i18n[lang] || i18n.en;

    // --- CONFIG FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyAHGs4Lcd-KefevIcsum5BwBHM9zimso0c",
        authDomain: "shinesungame.firebaseapp.com",
        projectId: "shinesungame",
        databaseURL: "https://shinesungame-default-rtdb.europe-west1.firebasedatabase.app/",
        storageBucket: "shinesungame.firebasestorage.app",
        messagingSenderId: "716211150472",
        appId: "1:716211150472:web:ad27a69f590a9c7bfb893d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const tg = window.Telegram.WebApp;
    
    let user = tg.initDataUnsafe.user || { id: "test_user", first_name: "Player" };
    let score = 0, energy = 1000, ownedItems = {}, completedMissions = {};
    
    const upgrades = [
        {id:'u1', boost:2, price:1000, icon:'‚òÄÔ∏è'},
        {id:'u2', boost:5, price:5000, icon:'üíé'},
        {id:'u3', boost:10, price:15000, icon:'üåã'},
        {id:'u4', boost:25, price:50000, icon:'üî•'},
        {id:'u5', boost:60, price:150000, icon:'üí•'},
        {id:'u6', boost:150, price:500000, icon:'üåå'}
    ];

    function applyTranslations() {
        document.getElementById('txt-combo').innerText = texts.combo;
        document.getElementById('txt-nav-play').innerText = texts.play;
        document.getElementById('txt-nav-friends').innerText = texts.friends;
        document.getElementById('txt-nav-shop').innerText = texts.shop;
        document.getElementById('txt-friends-title').innerText = texts.friends_title;
        document.getElementById('txt-invite-msg').innerText = texts.invite_msg;
        document.getElementById('txt-btn-invite').innerText = texts.btn_invite;
        document.getElementById('txt-leader-title').innerText = texts.leader_title;
        document.getElementById('txt-mission-title').innerText = texts.missions;
        document.getElementById('txt-shop-title').innerText = texts.shop_title;
        
        const missionsHTML = `
            <div class="card-item"><div><b>TikTok</b><br><small>+20k</small></div><button class="btn-buy" onclick="completeMission('tt',20000,'https://tiktok.com/@shinesungold')">${texts.btn_go}</button></div>
            <div class="card-item"><div><b>Telegram</b><br><small>+15k</small></div><button class="btn-buy" onclick="completeMission('tg',15000,'https://t.me/shinesun_gold')">${texts.btn_join}</button></div>
            <div class="card-item"><div><b>X (Twitter)</b><br><small>+10k</small></div><button class="btn-buy" onclick="completeMission('x',10000,'https://x.com/shinesun_gold')">${texts.btn_follow}</button></div>
        `;
        document.getElementById('missions-container').innerHTML = missionsHTML;
    }

    function init() {
        applyTranslations();
        db.ref('users/' + user.id).on('value', (snap) => {
            const d = snap.val() || {};
            score = d.score || 0; ownedItems = d.ownedItems || {}; completedMissions = d.completedMissions || {};
            renderShop(); updateUI();
        });

        const startParam = tg.initDataUnsafe.start_param;
        if (startParam && startParam !== user.id.toString()) {
            db.ref('referrals/' + user.id).once('value', (s) => {
                if(!s.exists()) {
                    db.ref('users/' + startParam).child('score').transaction(s => (s||0) + 50000);
                    db.ref('referrals/' + user.id).set(startParam);
                }
            });
        }
        loadLeaderboard();
        setInterval(() => { if(energy < 1000) { energy += 3; updateEnergyUI(); }}, 1000);
    }

    function shareTelegram() {
        const link = `https://t.me/shinesungame_bot?start=${user.id}`;
        const shareUrl = `https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(texts.share_msg)}`;
        tg.openTelegramLink(shareUrl);
    }

    function loadLeaderboard() {
        db.ref('users').orderByChild('score').limitToLast(10).on('value', (snap) => {
            let html = ''; let users = [];
            snap.forEach(c => { users.push(c.val()); });
            users.reverse().forEach((u, i) => {
                html += `<div class="leader-row"><span>#${i+1} ${u.name}</span><b>${Math.floor(u.score).toLocaleString()}</b></div>`;
            });
            document.getElementById('leader-list').innerHTML = html || "No data";
        });
    }

    function renderShop() {
        let h = ''; upgrades.forEach((u, i) => {
            const owned = ownedItems[u.id];
            h += `<div class="card-item"><div><b>${u.icon} ${texts.upgrades[i]}</b><br><small>+${u.boost}/clic</small></div>
            <button class="btn-buy ${owned?'owned':''}" onclick="buy('${u.id}',${u.price})">${owned?texts.owned:u.price.toLocaleString()}</button></div>`;
        });
        document.getElementById('shop-list').innerHTML = h;
    }

    function buy(id, p) { if(score >= p && !ownedItems[id]) { score -= p; ownedItems[id] = true; save(); } }

    document.getElementById('sun-btn').onclick = (e) => {
        if(energy < 1) return;
        let tap = 1; upgrades.forEach(u => { if(ownedItems[u.id]) tap += u.boost; });
        score += tap; energy -= 1; updateEnergyUI(); save();
        showPop(e, tap); tg.HapticFeedback.impactOccurred('medium');
    };

    function save() { db.ref('users/' + user.id).update({score, ownedItems, completedMissions, name: user.first_name}); }
    function completeMission(id, r, l) { window.open(l, '_blank'); setTimeout(() => { if(!completedMissions[id]) { score += r; completedMissions[id] = true; save(); }}, 3000); }
    function showView(v) { document.querySelectorAll('.view-panel').forEach(p => p.style.display = 'none'); document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active')); if(v !== 'game') document.getElementById(v + '-panel').style.display = 'block'; document.getElementById('nav-' + v).classList.add('active'); }
    function updateUI() { document.getElementById('score-display').innerText = Math.floor(score).toLocaleString(); }
    function updateEnergyUI() { document.getElementById('energy-fill').style.width = (energy/10) + '%'; document.getElementById('energy-val').innerText = Math.floor(energy); }
    function showPop(e, t) {
        const f = document.createElement('div'); f.innerText = '+' + t;
        f.style.cssText = `position:absolute; left:${e.clientX}px; top:${e.clientY}px; color:var(--sun-main); font-weight:900; font-size:30px; pointer-events:none; z-index:2000;`;
        f.animate([{transform:'translateY(0)', opacity:1}, {transform:'translateY(-100px)', opacity:0}], 600);
        document.body.appendChild(f); setTimeout(() => f.remove(), 600);
    }
    window.onload = () => { tg.expand(); init(); };
</script>
</body>
</html>
